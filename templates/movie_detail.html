{% extends "base.html" %}

{% block title %}{{ movie.title }} - æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹{% endblock %}

{% block head %}
<style>
    .movie-detail-card {
        background-color: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        padding: 30px;
        margin: auto;
        max-width: 800px;
    }

    .poster-img {
        display: block;
        max-width: 300px;
        height: auto;
        margin: 0 auto 20px;
        border-radius: 8px;
        box-shadow: 0 0 6px rgba(0,0,0,0.1);
    }

    .section {
        margin-bottom: 20px;
    }

    .section h2 {
        margin: 0 0 5px;
        font-size: 1.1em;
        color: #333;
    }

    .section p {
        margin: 0;
        line-height: 1.6;
        color: #444;
    }

    /* èˆˆè¡Œåå…¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®ç‰¹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
    .revenue-section {
        background: linear-gradient(135deg, #e8f5e8, #f0f8e8);
        border-radius: 12px;
        padding: 20px;
        margin: 20px 0;
        border-left: 4px solid #4caf50;
    }

    .revenue-main {
        font-size: 1.2em;
        font-weight: 600;
        color: #2e7d32;
        margin-bottom: 8px;
    }

    .revenue-amount {
        font-size: 2.5em;
        font-weight: 700;
        color: #1b5e20;
        margin: 10px 0;
        font-family: 'Noto Sans JP', Arial, sans-serif;
    }

    .revenue-link {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: linear-gradient(135deg, #4caf50, #388e3c);
        color: white;
        padding: 8px 16px;
        border-radius: 20px;
        text-decoration: none;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
    }

    .revenue-link:hover {
        background: linear-gradient(135deg, #388e3c, #2e7d32);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        color: white;
    }

    .revenue-link-icon {
        font-size: 16px;
    }

    /* ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ã‚°ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .genre-container {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 8px;
    }

    .genre-tag {
        display: inline-block;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        padding: 6px 12px;
        border-radius: 16px;
        font-size: 12px;
        font-weight: 500;
        text-decoration: none;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .genre-tag:hover {
        background: linear-gradient(135deg, #5a6fd8, #6b42b3);
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        color: white;
    }

    .genre-tag.action { background: linear-gradient(135deg, #ff6b6b, #ee5a52); }
    .genre-tag.drama { background: linear-gradient(135deg, #4ecdc4, #44a08d); }
    .genre-tag.comedy { background: linear-gradient(135deg, #ffe259, #ffc845); color: #333; }
    .genre-tag.animation { background: linear-gradient(135deg, #a8e6cf, #7fcdcd); color: #333; }
    .genre-tag.romance { background: linear-gradient(135deg, #ff8a80, #ff5722); }
    .genre-tag.thriller { background: linear-gradient(135deg, #424242, #212121); }
    .genre-tag.horror { background: linear-gradient(135deg, #8e24aa, #5e35b1); }
    .genre-tag.scifi { background: linear-gradient(135deg, #29b6f6, #0277bd); }
    .genre-tag.fantasy { background: linear-gradient(135deg, #ba68c8, #9c27b0); }

    .copyright {
        font-size: 0.8em;
        color: #777;
        margin-top: 10px;
        text-align: center;
    }

    .back-button {
        display: inline-block;
        margin-bottom: 20px;
        padding: 6px 14px;
        background-color: #1a73e8;
        color: #fff;
        border-radius: 6px;
        text-decoration: none;
        font-size: 0.9em;
    }

    .back-button:hover {
        background-color: #1558b0;
    }

    /* ãƒªãƒ³ã‚¯ä»˜ãã‚¢ã‚¤ãƒ†ãƒ ã®ã‚¹ã‚¿ã‚¤ãƒ« */
    .clickable-item {
        color: #1a73e8;
        text-decoration: none;
        transition: color 0.3s ease;
    }

    .clickable-item:hover {
        color: #1558b0;
        text-decoration: underline;
    }

    /* ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è¦–è¦šçš„æ”¹å–„ */
    .section {
        padding: 12px 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .section:last-child {
        border-bottom: none;
    }

    .section h2 {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 1.1em;
        color: #333;
        margin-bottom: 8px;
    }

    .section-icon {
        font-size: 1.2em;
    }

    /* æ¨ç§»ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨å¯èƒ½ãƒãƒƒã‚¸ */
    .data-available-badge {
        display: inline-flex;
        align-items: center;
        gap: 4px;
        background: #e3f2fd;
        color: #1976d2;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 11px;
        font-weight: 600;
        margin-left: 8px;
    }

    .data-available-badge.available {
        background: #e8f5e8;
        color: #2e7d32;
    }

    .data-available-badge.unavailable {
        background: #ffebee;
        color: #d32f2f;
    }

    /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
    @media (max-width: 767px) {
        .movie-detail-card {
            padding: 20px;
        }

        .poster-img {
            max-width: 250px;
        }

        .revenue-amount {
            font-size: 2em;
        }

        .revenue-section {
            padding: 16px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="movie-detail-card">

    <a class="back-button" href="{{ url_for('search') }}">â† ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</a>

    <h1 style="text-align: center;">{{ movie.title }}</h1>

    {% if movie.movie_id %}
        <img class="poster-img" src="{{ url_for('static', filename='posters/' ~ movie.movie_id|string ~ '.jpg') }}" alt="ãƒã‚¹ã‚¿ãƒ¼ç”»åƒ">
    {% else %}
        <p style="text-align: center;">ãƒã‚¹ã‚¿ãƒ¼ç”»åƒãŒã‚ã‚Šã¾ã›ã‚“</p>
    {% endif %}

    {% if movie.copyright %}
        <div class="copyright">{{ movie.copyright }}</div>
    {% endif %}

    <div class="section">
        <h2>å…¬é–‹æ—¥</h2>
        <p>{{ movie.release_date or 'æƒ…å ±ãªã—' }}</p>
    </div>

    <!-- èˆˆè¡Œåå…¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¼·åŒ–ç‰ˆï¼‰ -->
    <div class="revenue-section">
        <div class="revenue-main">èˆˆè¡Œåå…¥</div>
        <div class="revenue-amount">{{ movie.revenue }}å„„å††</div>
        
        {% if movie.movie_id %}
            <!-- èˆˆåæ¨ç§»ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèªã¯ JavaScript ã§è¡Œã† -->
            <a href="{{ url_for('box_office_detail', movie_id=movie.id) }}" class="revenue-link" id="revenueLink">
                <span class="revenue-link-icon">ğŸ“ˆ</span>
                æ¨ç§»ãƒ‡ãƒ¼ã‚¿
            </a>
            <span class="data-available-badge" id="dataAvailableBadge" style="display: none;">
                ğŸ“Š ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨å¯èƒ½
            </span>
        {% endif %}
    </div>

    <div class="section">
        <h2>é…çµ¦ä¼šç¤¾</h2>
        <p>
            {% if movie.distributor %}
                {% for dist in movie.distributor.split('ã€') %}
                    <a href="{{ url_for('search', distributor=dist.strip()) }}" class="clickable-item">{{ dist.strip() }}</a>{% if not loop.last %}ã€{% endif %}
                {% endfor %}
            {% else %}
                æƒ…å ±ãªã—
            {% endif %}
        </p>
    </div>

    <!-- ã‚¸ãƒ£ãƒ³ãƒ«æƒ…å ±ï¼ˆå¼·åŒ–ç‰ˆï¼‰ -->
    {% if movie.genre %}
    <div class="section">
        <h2>ã‚¸ãƒ£ãƒ³ãƒ«</h2>
        <p>
            {% for genre_item in movie.genre.split(',') %}
                <a href="{{ url_for('search', genre=genre_item.strip()) }}" class="clickable-item">{{ genre_item.strip() }}</a>{% if not loop.last %}ã€{% endif %}
            {% endfor %}
        </p>
    </div>
    {% endif %}

    <div class="section">
        <h2>ã‚ã‚‰ã™ã˜</h2>
        <p>{{ movie.description or 'æƒ…å ±ãªã—' }}</p>
    </div>

    {% if movie.director %}
    <div class="section">
        <h2>ç›£ç£</h2>
        <p><a href="{{ url_for('search', director=movie.director) }}" class="clickable-item">{{ movie.director }}</a></p>
    </div>
    {% endif %}

    {% if movie.scriptwriter %}
    <div class="section">
        <h2>è„šæœ¬</h2>
        <p><a href="{{ url_for('search', scriptwriter=movie.scriptwriter) }}" class="clickable-item">{{ movie.scriptwriter }}</a></p>
    </div>
    {% endif %}

    {% if movie.author %}
    <div class="section">
        <h2>åŸä½œ</h2>
        <p>{{ movie.author }}</p>
    </div>
    {% endif %}

    {% if movie.producer %}
    <div class="section">
        <h2>ãƒ—ãƒ­ãƒ‡ãƒ¥ãƒ¼ã‚µãƒ¼</h2>
        <p><a href="{{ url_for('search', producer=movie.producer) }}" class="clickable-item">{{ movie.producer }}</a></p>
    </div>
    {% endif %}

    {% if movie.actor %}
    <div class="section">
        <h2>ã‚­ãƒ£ã‚¹ãƒˆ</h2>
        <p>
            {% for actor in movie.actor.split(',') %}
                <a href="{{ url_for('search', actor=actor.strip()) }}" class="clickable-item">{{ actor.strip() }}</a>{% if not loop.last %}ã€{% endif %}
            {% endfor %}
        </p>
    </div>
    {% endif %}

</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // èˆˆåæ¨ç§»ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèª
        const movieId = {{ movie.id }};
        const revenueLink = document.getElementById('revenueLink');
        const dataAvailableBadge = document.getElementById('dataAvailableBadge');
        
        if (revenueLink) {
            // èˆˆåæ¨ç§»ãƒ‡ãƒ¼ã‚¿ã®å­˜åœ¨ç¢ºèªAPIå‘¼ã³å‡ºã—
            fetch(`/api/box-office-check/${movieId}`)
                .then(response => response.json())
                .then(data => {
                    if (data.has_data) {
                        // ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹å ´åˆ
                        if (dataAvailableBadge) {
                            dataAvailableBadge.style.display = 'inline-flex';
                            dataAvailableBadge.classList.add('available');
                            dataAvailableBadge.innerHTML = 'ğŸ“Š æ¨ç§»ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨å¯èƒ½';
                        }
                        
                        // ãƒªãƒ³ã‚¯ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¼·èª¿
                        revenueLink.style.background = 'linear-gradient(135deg, #4caf50, #388e3c)';
                        revenueLink.style.boxShadow = '0 2px 8px rgba(76, 175, 80, 0.3)';
                    } else {
                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆ
                        revenueLink.style.display = 'none';
                        
                        if (dataAvailableBadge) {
                            dataAvailableBadge.style.display = 'inline-flex';
                            dataAvailableBadge.classList.add('unavailable');
                            dataAvailableBadge.innerHTML = 'ğŸ“Š æ¨ç§»ãƒ‡ãƒ¼ã‚¿ãªã—';
                        }
                    }
                })
                .catch(error => {
                    console.error('èˆˆåæ¨ç§»ãƒ‡ãƒ¼ã‚¿ç¢ºèªã‚¨ãƒ©ãƒ¼:', error);
                    // ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã—ãŸã¾ã¾
                });
        }
    });

    window.addEventListener("load", function() {
        window.scrollTo(0, 165);  // â† ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿ç›´å¾Œã«200pxä¸‹ã«ãƒ”ã‚¿ãƒƒã¨è¡¨ç¤º
    });

    // ã‚¸ãƒ£ãƒ³ãƒ«ã‚¿ã‚°ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    document.addEventListener('DOMContentLoaded', function() {
        const genreTags = document.querySelectorAll('.genre-tag');
        genreTags.forEach((tag, index) => {
            tag.style.opacity = '0';
            tag.style.transform = 'translateY(10px)';
            setTimeout(() => {
                tag.style.transition = 'all 0.5s ease';
                tag.style.opacity = '1';
                tag.style.transform = 'translateY(0)';
            }, index * 100);
        });
    });

    // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ï¼šã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³
    document.querySelectorAll('.genre-tag, .clickable-item').forEach(element => {
        element.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                this.click();
            }
        });
        element.setAttribute('tabindex', '0');
    });
</script>

{% endblock %}