{% extends "base.html" %}

{% block title %}
{% if article %}è¨˜äº‹ç·¨é›†{% else %}æ–°è¦è¨˜äº‹ä½œæˆ{% endif %} - æ˜ ç”»ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
{% endblock %}

{% block head %}
<style>
    .admin-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
    }

    .admin-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 20px;
        background: var(--card-background);
        border-radius: 12px;
        box-shadow: var(--shadow);
    }

    .admin-title {
        font-size: 24px;
        font-weight: 700;
        color: var(--text-color);
        margin: 0;
    }

    .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        font-size: 14px;
        cursor: pointer;
        transition: var(--transition);
    }

    .btn-primary {
        background: var(--primary-color);
        color: white;
    }

    .btn-success {
        background: var(--secondary-color);
        color: white;
    }

    .article-form {
        background: var(--card-background);
        border-radius: 12px;
        box-shadow: var(--shadow);
        padding: 30px;
    }

    .form-group {
        margin-bottom: 24px;
    }

    .form-label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: var(--text-color);
    }

    .form-input {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 14px;
        transition: var(--transition);
        box-sizing: border-box;
    }

    .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .form-textarea {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
        min-height: 120px;
        font-family: inherit;
        transition: var(--transition);
        box-sizing: border-box;
    }

    .form-textarea.content {
        min-height: 300px;
    }

    .form-textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .form-select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid var(--border-color);
        border-radius: 8px;
        font-size: 14px;
        background: white;
        transition: var(--transition);
        box-sizing: border-box;
    }

    .form-select:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.1);
    }

    .form-check {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 8px;
    }

    .form-check-input {
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .form-check-label {
        font-weight: 500;
        color: var(--text-color);
        cursor: pointer;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .form-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
    }

    .error-message {
        background: #ffebee;
        border: 1px solid #f44336;
        color: #d32f2f;
        padding: 12px 16px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
    }

    .form-help {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 4px;
    }

    @media (max-width: 767px) {
        .form-grid {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="admin-container">
    <div class="admin-header">
        <h1 class="admin-title">
            {% if article %}âœï¸ è¨˜äº‹ç·¨é›†{% else %}â• æ–°è¦è¨˜äº‹ä½œæˆ{% endif %}
        </h1>
        <div class="admin-actions">
            <a href="{{ url_for('admin_articles') }}" class="btn btn-primary">
                ğŸ“‹ è¨˜äº‹ä¸€è¦§ã«æˆ»ã‚‹
            </a>
        </div>
    </div>

    {% if error %}
    <div class="error-message">
        {{ error }}
    </div>
    {% endif %}

    <form method="post" class="article-form">
        <div class="form-group">
            <label class="form-label" for="title">è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ« *</label>
            <input type="text" id="title" name="title" class="form-input" 
                   value="{{ article.title if article else (form_data.title if form_data else '') }}" 
                   required placeholder="æ˜ ç”»ã«é–¢ã™ã‚‹è¨˜äº‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
            <div class="form-help">SEOã‚’è€ƒæ…®ã—ã¦ã€æ¤œç´¢ã•ã‚Œã‚„ã™ã„ã‚¿ã‚¤ãƒˆãƒ«ã‚’è¨­å®šã—ã¾ã—ã‚‡ã†</div>
        </div>

        <div class="form-grid">
            <div class="form-group">
                <label class="form-label" for="author">ä½œæˆè€…</label>
                <input type="text" id="author" name="author" class="form-input" 
                       value="{{ article.author if article else (form_data.author if form_data else '') }}" 
                       placeholder="è¨˜äº‹ã®ä½œæˆè€…å">
            </div>

            <div class="form-group">
                <label class="form-label" for="category">ã‚«ãƒ†ã‚´ãƒª</label>
                <select id="category" name="category" class="form-select">
                    <option value="">ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠ</option>
                    {% for cat in categories %}
                    <option value="{{ cat }}" 
                            {% if article and article.category == cat %}selected{% endif %}
                            {% if form_data and form_data.category == cat %}selected{% endif %}>
                        {{ cat }}
                    </option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label" for="excerpt">è¨˜äº‹ã®æŠœç²‹</label>
            <textarea id="excerpt" name="excerpt" class="form-textarea" 
                      placeholder="è¨˜äº‹ã®è¦ç´„ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆç©ºç™½ã®å ´åˆã¯è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ï¼‰">{{ article.excerpt if article else (form_data.excerpt if form_data else '') }}</textarea>
            <div class="form-help">è¨˜äº‹ä¸€è¦§ã§è¡¨ç¤ºã•ã‚Œã‚‹è¦ç´„æ–‡ã§ã™ã€‚150-200æ–‡å­—ç¨‹åº¦ãŒãŠã™ã™ã‚ã§ã™</div>
        </div>

        <div class="form-group">
            <label class="form-label" for="content">è¨˜äº‹å†…å®¹ *</label>
            <textarea id="content" name="content" class="form-textarea content" 
                      required placeholder="è¨˜äº‹ã®æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">{{ article.content if article else (form_data.content if form_data else '') }}</textarea>
            <div class="form-help">è¨˜äº‹ã®æœ¬æ–‡ã‚’è©³ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="form-group">
            <label class="form-label" for="tags">ã‚¿ã‚°</label>
            <input type="text" id="tags" name="tags" class="form-input" 
                   value="{{ article.tags if article else (form_data.tags if form_data else '') }}" 
                   placeholder="ã‚¿ã‚°ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§å…¥åŠ›ï¼ˆä¾‹: ã‚¢ãƒ‹ãƒ¡,èˆˆè¡Œåå…¥,ãƒˆãƒ¬ãƒ³ãƒ‰ï¼‰">
            <div class="form-help">è¨˜äº‹ã«é–¢é€£ã™ã‚‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚«ãƒ³ãƒã§åŒºåˆ‡ã£ã¦å…¥åŠ›ã—ã¦ãã ã•ã„</div>
        </div>

        <div class="form-group">
            <div class="form-check">
                <input type="checkbox" id="is_featured" name="is_featured" class="form-check-input"
                       {% if article and article.is_featured %}checked{% endif %}
                       {% if form_data and form_data.is_featured %}checked{% endif %}>
                <label class="form-check-label" for="is_featured">
                    â­ æ³¨ç›®è¨˜äº‹ã¨ã—ã¦è¡¨ç¤ºã™ã‚‹
                </label>
            </div>
            <div class="form-help">ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã¨è¨˜äº‹ä¸€è¦§ã®ãƒˆãƒƒãƒ—ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
        </div>

        <div class="form-actions">
            <a href="{{ url_for('admin_articles') }}" class="btn" style="background: #666; color: white;">
                ã‚­ãƒ£ãƒ³ã‚»ãƒ«
            </a>
            <button type="submit" class="btn btn-success">
                {% if article %}ğŸ’¾ è¨˜äº‹ã‚’æ›´æ–°{% else %}ğŸ“ è¨˜äº‹ã‚’ä½œæˆ{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
function addCharacterCounter(elementId, maxLength) {
    const element = document.getElementById(elementId);
    if (!element) return;
    
    const counterDiv = document.createElement('div');
    counterDiv.className = 'form-help';
    counterDiv.style.textAlign = 'right';
    element.parentNode.appendChild(counterDiv);
    
    function updateCounter() {
        const length = element.value.length;
        counterDiv.textContent = `${length}${maxLength ? '/' + maxLength : ''}æ–‡å­—`;
        
        if (maxLength && length > maxLength) {
            counterDiv.style.color = 'var(--accent-color)';
        } else {
            counterDiv.style.color = 'var(--text-secondary)';
        }
    }
    
    element.addEventListener('input', updateCounter);
    updateCounter();
}

// æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚’è¿½åŠ 
document.addEventListener('DOMContentLoaded', function() {
    addCharacterCounter('title', 100);
    addCharacterCounter('excerpt', 300);
    addCharacterCounter('content');
    
    // è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    const form = document.querySelector('.article-form');
    if (!form) return;
    
    let autoSaveTimer;
    
    function autoSave() {
        const formData = new FormData(form);
        const title = formData.get('title');
        
        if (title) {
            localStorage.setItem('article_draft', JSON.stringify({
                title: formData.get('title'),
                content: formData.get('content'),
                excerpt: formData.get('excerpt'),
                author: formData.get('author'),
                category: formData.get('category'),
                tags: formData.get('tags'),
                timestamp: new Date().toISOString()
            }));
        }
    }
    
    // å…¥åŠ›æ™‚ã®è‡ªå‹•ä¿å­˜
    form.addEventListener('input', function() {
        clearTimeout(autoSaveTimer);
        autoSaveTimer = setTimeout(autoSave, 3000); // 3ç§’å¾Œã«ä¿å­˜
    });
    
    // é€ä¿¡æ™‚ã«ä¸‹æ›¸ãã‚’å‰Šé™¤
    form.addEventListener('submit', function() {
        localStorage.removeItem('article_draft');
    });
});
</script>
{% endblock %}